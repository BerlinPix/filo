/*!
 * URL: http://www.berlinpix.com/filo
 * Author: Erik Wendt
 * Version: 2.1.2
 */
;(function( $ ) {

$.fn.filo=function(a){return"undefined"==typeof a&&(a={}),0!==this.length?this.each(function(b,c){var d=$(this).attr("data-facebook-id"),e=$(this).find(".filo__album"),f=$(this).data(),g=$.extend({container:c,facebookId:d},a,f);"number"==typeof g.facebookId&&(g.facebookId=g.facebookId.toString()),$(this).addClass("filo"),e.length>0&&(g.albums=[],$.each(e,function(a,b){if(void 0!==$(b).data("albumName")&&$(b).data("albumName").length>0){var c=$.extend({name:$(b).data("albumName")},$(b).data());g.albums.push(c)}})),$(this).data("excluded")&&(g.excluded=$(this).data("excluded").split(",").map(function(a){return a.trim()})),$.filo(g)}):(console.log('no container can be selected with the selector "'+this.selector+'". please check the jQuery selector for special characters like "." and escape them with "\\\\."'),console.log("http://learn.jquery.com/using-jquery-core/faq/how-do-i-select-an-element-by-an-id-that-has-characters-used-in-css-notation/"),void 0!==typeof a.logging&&a.logging===!0&&alert('no container can be selected with the selector "'+this.selector+'". please check the jQuery selector for special characters like "." and escape them with "\\\\."'),void 0)},$(function(){var a=$(".filo");a.length>0&&$(a).filo()}),$.filo=function(a){"undefined"==typeof a&&(a={}),$.support.cors=!0;for(var b=$.extend({accessToken:!1,addAsPhotoStream:!1,albums:[],load:function(){},before:function(){},closeButton:"/img/close_black.png",container:"body",defaultImage:"/img/default.png",excluded:[],hideTitle:!1,href:"",isLoaded:new Array,logging:!1,match:!1,maxCount:10,maxWidth:90,maxHeight:90,maxPreview:1/0,method:"post",newWindow:!1,order:"normal",photos_array:null,proxyUrl:"https://bpx.gacrux.uberspace.de/filo-proxy/",resize:!1,root_path:getRootPath(),setImageLink:!1,template:1,titleTag:"h3",toLoad:new Array},a),c=0;c<b.albums.length;c++)"string"==typeof b.albums[c]&&(b.albums[c]={name:b.albums[c]});if("string"==typeof a.facebookId)filoHandler(a.facebookId,b);else if($.isArray(a.facebookId)&&a.facebookId.length>0)for(var c=0;c<a.facebookId.length;c++)filoHandler(a.facebookId[c],b);else b.logging&&console.log("please check the Facebook ID(s), must be a single string or an array of IDs")};var filoHandler=function(a,b){var c=getUniqueID(),d=b.container;addLoaderGraphic(b),$(d).attr("data-filo-uid",c),b.addAsPhotoStream&&$(d).addClass("filo--stream"),getAllAlbumsData("facebook",a,b,function(d,e){return d?(console.log(d),void removeLoaderGraphic()):("function"==typeof b.before&&b.before(),void("undefined"!=typeof b.albums&&b.albums.length>0?addSpecificAlbums(e.data,b,c,a):addAllAlbums(e.data,b,c,a)))})},addAllAlbums=function(a,b,c,d){$.each(a,function(a,e){var f=" filo__template-"+b.template,g=null,h=null,i=null;inArray(e.name,b.excluded)||(g=c+"_"+getUniqueID(filoEscape(e.name)),h=b.hideTitle===!0||b.addAsPhotoStream===!0?"":"<"+b.titleTag+' class="filo__album__title">'+e.name+"</"+b.titleTag+">",i=$('<div id="'+g+'" class="filo__album'+f+'">'+h+'<div class="filo__album__thumbs"></div></div>'),$('[data-filo-uid="'+filoEscape(c)+'"]').append(i),b.toLoad.push(e.name),handleAlbum(c,d,e,g,i,b))})},addSpecificAlbums=function(a,b,c,d){var e=!1,f='[data-filo-uid="'+filoEscape(c)+'"]',g=$(f).find(".filo__album").length>0,h=[];$.each(a,function(i,j){var k=albumInArray(j.name,b);return k?void $.each(k,function(k,l){var m={};$.extend(m,b,b.albums[l.index]);var n="";n=l!==!1?" filo__template-"+m.template:" filo__template-"+b.template;var o=c+"_"+getUniqueID(filoEscape(j.name)),p="undefined"!=typeof m.title?m.title:j.name,q=b.hideTitle===!0||b.addAsPhotoStream===!0?"":"<"+b.titleTag+' class="filo__album__title">'+p+"</"+b.titleTag+">",r=$('<div id="'+o+'" class="filo__album'+n+'">'+q+'<div class="filo__album__thumbs"></div></div>'),s=null;g?(s=getAlbumContainer(f,j),$(s).after(r),h.push(s)):l.index>$(f).find(".filo__album").length-1?$(f).append(r):$($(f).find(".filo__album").get(l.index)).before(r),b.toLoad.push(j.name),handleAlbum(c,d,j,o,r,m),e=!0,i===a.length-1&&(e||(alert("No Facebook albums found, please check the names in your list\n\nalbum: "+b.albums),removeLoaderGraphic()))}):void(i===a.length-1&&(removeAlbums(h),removeLoaderGraphic()))})},removeAlbums=function(a){$(a).each(function(){$(this).length>0&&$(this).remove()})},getAlbumContainer=function(a,b){var c=null,d=null;return $(a).find(".filo__album").each(function(a,e){try{d=new RegExp($(e).attr("data-album-name"),"i")}catch(f){return void console.log(f)}return"undefined"!=typeof $(e).attr("data-album-name")&&null!==b.name.match(d)?(c=e,!1):void 0}),c},getAllAlbumsData=function(a,b,c,d){var e=null,f=c.accessToken?"?access_token="+c.accessToken:"",g=c.accessToken?"https://graph.facebook.com/":c.proxyUrl;switch(a){case"facebook":e=g+b+"/albums/"+f}$.getJSON(e,function(a){d(null,a)}).fail(function(b,c,e){d("couldn't load the data from "+a+". please check the ID and access token")})},handleAlbum=function(a,b,c,d,e,f){getAlbumData("facebook",c,f,function(g,h){if(g)return console.log(g),void removeLoaderGraphic();var i=h.data,j="all"===f.maxCount?i.length:f.maxCount;switch(f.order){case"reverse":addReverseOrder(a,j,i,b,c,d,f,e);break;case"random":addRandomOrder(a,j,i,b,c,d,f,e);break;case"normal":default:addNormalOrder(a,j,i,b,c,d,f,e)}f.isLoaded.push(c);var k=f.isLoaded.length/f.toLoad.length*100;updateLoaderGraphic(k),f.addAsPhotoStream&&$("#"+d).remove(),f.isLoaded.length>=f.toLoad.length&&(removeLoaderGraphic(),$(".filo .excluded").remove(),f.load(),f.setImageLink&&openImageFromHash(f.facebookId,c.name))})},openImageFromHash=function(a,b){var c,d,e,f;window.location.hash.indexOf("/filo/")<0||(c=window.location.hash.split("/"),d=c[2],e=c[3],f=parseInt(c[4])-1,d===a&&e===b&&$('[data-hash="'+a+"-"+b+"-"+f+'"]').length>0&&$('[data-hash="'+a+"-"+b+"-"+f+'"]').trigger("filo-click"))},addNormalOrder=function(a,b,c,d,e,f,g,h){for(var i=[],j=0;j<Math.min(b,c.length);j++)i.push(c[j]);for(j=0;j<i.length;j++)handlePhoto(d,e,f,i[j],i,g,j,a)},addRandomOrder=function(a,b,c,d,e,f,g,h){for(var i=[],j=[];i.length<b&&i.length<c.length;){var k=Math.floor(Math.random()*c.length);void 0===j[k]&&(i.push(c[k]),j[k]=!0)}for(var l=0;l<i.length;l++)handlePhoto(d,e,f,i[l],i,g,l)},addReverseOrder=function(a,b,c,d,e,f,g,h){for(var i=[],j=Math.min(b,c.length)-1;j>=0;j--)i.push(c[j]);for(var j=0;j<i.length;j++)handlePhoto(d,e,f,i[j],i,g,j)},getAlbumData=function(a,b,c,d){var e,f=null,g=getMaxCount(c),h="",i=100,j=c.accessToken?"https://graph.facebook.com/":c.proxyUrl,k={access_token:c.accessToken?c.accessToken:"",fields:["images"],limit:g};switch($.each(Object.keys(k),function(a,b){h+=(0===a?"?":"&")+b+"="+k[b]}),a){case"facebook":f=j+b.id+"/photos"+h;break;default:f=j+b.id+"/photos"+h}(e=function(a,d){$.getJSON(a,function(a){if(g>i&&a.paging&&a.paging.next){var b=c.accessToken?a.paging.next:c.proxyUrl+a.paging.next.split("facebook.com/")[1];e(b,function(b,c){b?d(b):(a.data=a.data.concat(c.data),d(null,a))})}else d(null,a)}).fail(function(){d("couldn't load the data of the album: \""+b.name+'". please check the facebook ID and access token')})})(f,d)},getMaxCount=function(a){var b=25;return"number"==typeof a.maxCount?b=a.maxCount:"all"===a.maxCount?b=1e3:parseInt(a.maxCount)>0&&(b=parseInt(a.maxCount)),b},handlePhoto=function(a,b,c,d,e,f,g,h){var i=null,j=null,k=getBigPictureFromSize(d),l="filo__album__thumbs__thumb",m=$('<a class="'+l+'" data-child="'+g+'" href="'+k+'"></a>'),n=null,o="undefined"==typeof f.maxPreview||isNaN(parseInt(f.maxPreview))?1/0:parseInt(f.maxPreview);$(m).attr("data-hash",a+"-"+b.name+"-"+g),$(m).on("click filo-click",function(c){c.preventDefault(),"string"==typeof f.href&&f.href.length>0?forwardUser(a,b.name,f):showOverlay(m,b,$.inArray(d,e),e,$(this).attr("href"),f),"click"===c.type&&f.setImageLink&&setUrlHash(a,b.name,g)}),f.addAsPhotoStream?$("#"+filoEscape(c)).after(m):$("#"+filoEscape(c)).find(".filo__album__thumbs").append(m),"undefined"!=typeof f.thumbWidth&&"undefined"!=typeof f.thumbHeight?(i=f.thumbWidth,j=f.thumbHeight):"none"!==$(m).css("maxWidth")&&$(m).css("maxWidth").indexOf("px")>-1?(i=$(m).css("maxWidth"),j=$(m).css("maxWidth")):(i="300",j="300"),n=getPictureFromSize(i,j,d),n.width/n.height<4/3&&n.width/n.height>.75?$(m).addClass(l+"--quadratic"):n.width>n.height?$(m).addClass(l+"--horizontal"):$(m).addClass(l+"--vertical"),o>g&&$(m).append('<i style="background-image:url('+n.source+');" ></i>')},getPictureFromSize=function(a,b,c){var d=a,e=b,f=null;"string"==typeof d&&-1!==d.indexOf("px")&&(d=d.split("px")[0]),"string"==typeof e&&-1!==d.indexOf("px")&&(e=e.split("px")[0]);for(var g=c.images.length-1;g>=0;g--)(parseInt(c.images[g].width)>=parseInt(d)&&null===f||parseInt(c.images[g].width)>=parseInt(d)&&parseInt(c.images[g].width)<parseInt(f.width))&&(f=c.images[g]);return null===f?{}:f},getBigPictureFromSize=function(a){var b=a.images[0];return b.source},forwardUser=function(a,b,c){if(void 0!==c.method&&"post"===c.method.toLowerCase()){var d=c.newWindow===!0?'target="_blank"':"";return $("body").append('<form id="filo_forward" '+d+' method="POST" action="'+c.href+'"><input name="profile" value="'+a+'" /><input name="album" value="'+b+'" /></form>'),$("#filo_forward").trigger("submit").remove(),!1}return c.newWindow?(window.open(c.href+"?profile="+a+"&album="+b),!1):(document.location=c.href+"?profile="+a+"&album="+b,!1)},showOverlay=function(a,b,c,d,e,f){var c=c,g="";addLoaderGraphic(f),supportFullScreen()&&(g='<div class="filo__overlay__container__full" title="full screen"></div>'),$("body").append('<div class="filo__overlay"><div class="filo__overlay__background" style="background: '+f.overlay+"; opacity: "+f.overlayOpacity+';"></div><div class="filo__overlay__container"><div class="filo__overlay__container__left"><span class="arrow-left"></span></div><div class="filo__overlay__container__right"><span class="arrow-right"></span></div><div class="filo__overlay__container__meta"><div class="filo__overlay__container__meta__album" >'+b.name+'</div><div class="filo__overlay__container__meta__count" >'+(c+1)+" / "+d.length+"</div></div>"+g+"</div></div>");var h=new Image;h.onload=function(){removeLoaderGraphic(),$(".filo__overlay__container").append(h),this.setAttribute("width",this.width),this.setAttribute("height",this.height),resizeImage(f),$(".filo__overlay__container").fadeIn("slow")},h.setAttribute("class","filo_full_picture"),h.src=e,$(".filo__overlay").click(function(a){"filo__overlay__background"===$(a.target).attr("class")&&$(".filo__overlay").fadeOut(500,function(){$(".filo__overlay").remove()})}),$(window).unbind("resize"),$(window).resize(function(a){resizeImage(f)}),$(".filo__overlay__container__left").click(function(){c=prevImage(c,d,f),setUrlHash(f.facebookId,b.name,c)}),$(".filo__overlay__container__right").click(function(){c=nextImage(c,d,f),setUrlHash(f.facebookId,b.name,c)}),$(document).unbind("keyup"),$(document).bind("keyup",function(a){switch(a.keyCode){case 37:c=prevImage(c,d,f),f.setImageLink&&setUrlHash(f.facebookId,b.name,c);break;case 39:c=nextImage(c,d,f),f.setImageLink&&setUrlHash(f.facebookId,b.name,c)}}),$(".filo__overlay__container__full").click(function(a){var b=$(".filo__overlay")[0];toggleFullScreen(b),resizeImage(),$(".filo__overlay").toggleClass("is-full-screen")})},preload=function(a,b){if(0===a){var c=new Image;c.src=b[a+1]}else if(a===b.length-1){var c=new Image;c.src=b[a-1]}else{var c=new Image;c.src=b[a-1];var d=new Image;d.src=b[a+1]}},preparePrevImage=function(a){},prevImage=function(a,b,c){if(a>0){a-=1,addLoaderGraphic(c);var d=getBigPictureFromSize(b[a]);return $(".filo_full_picture").attr("src",d),$(".filo__overlay__container__meta__count").text(a+1+" / "+b.length),resizeImage(c),c.setImageLink&&setUrlHash(null,null,a),a}return shakeOverlay(),a},nextImage=function(a,b,c){if(a<b.length-1){a+=1,addLoaderGraphic(c);var d=getBigPictureFromSize(b[a]);return $(".filo_full_picture").attr("src",d),$(".filo__overlay__container__meta__count").text(a+1+" / "+b.length),resizeImage(c),c.setImageLink&&setUrlHash(null,null,a),a}return shakeOverlay(),a},shakeOverlay=function(){$(".filo__overlay__container").animate({left:"49%"},100).animate({left:"51%"},100).animate({left:"50%"},100)},resizeImage=function(a){if($(".filo__overlay").length>0){resize=!0;var b,c,d=(a.maxWidth?a.maxWidth:$.filo.maxWidth)/100,e=(a.maxHeight?a.maxHeight:$.filo.maxHeight)/100,f=parseInt($(".filo__overlay__container").css("border-top-width").split("px")[0]),g=0,h=$(window).width()*d-f,i=$(window).height()*e-(f+g),j=parseInt($(".filo_full_picture")[0].naturalWidth),k=parseInt($(".filo_full_picture")[0].naturalHeight);j>k?(b=j>h?h:j,c=b*k/j,c>i&&(c=k>i?i:k,b=c*j/k)):(c=k>i?i:k,b=c*j/k,b>h&&(b=j>h?h:j,c=b*k/j)),$(".filo__overlay__container").width(b).height(c).css("margin-left",b/2*-1).css("margin-top",c/2*-1-g).find(".filo_full_picture").width(b).height(c),resize=!1}},setUrlHash=function(a,b,c){var d=window.location.hash,e=c+1;d.indexOf("/filo/")&&(d=d.split("/")),a||(a=d[2]),b||(b=d[3]),$("html").attr("data-add-hash",!0),window.location.hash="/filo/"+a+"/"+b+"/"+e},getRootPath=function(){try{throw new Error}catch(a){var b="";if(void 0!=a.fileName)b=a.fileName.split("/");else{var c=document.getElementsByTagName("script");$.each(c,function(a,c){(c.src.indexOf("filo.js")>=0||c.src.indexOf("filo.min.js")>=0)&&(b=c.src.split("/"))})}if(""==b)return"filo/"}for(var d="",e=0;e<b.length-1;e++)d+=e<b.length-2?b[e]+"/":b[e];return d},getUniqueID=function(){return Date.now()+"_"+Math.round(1e5*Math.random())},filoEscape=function(a){return a.replace(/\./g,"-").replace(/ /g,"_").replace(/[(){}<>]/g,"-")},addLoaderGraphic=function(a,b){if(!($(".filo_loader").length>0))if(b===!0){var c=new Image;c.onload=function(){$(c).css("marginTop",this.height/2*-1),$(c).css("marginLeft",this.width/2*-1),$("body").append(c)},c.setAttribute("class","filo_loader"),"string"==typeof a.loaderGraphic&&(c.src=a.loaderGraphic)}else $("body").append('<div class="filo_loader"><div class="progress-bar blue stripes"><span style="width: 5%"></span></div></div>')},removeLoaderGraphic=function(){$(".filo_loader").fadeOut(1e3)},updateLoaderGraphic=function(a){$(".filo_loader").length>0&&$(".filo_loader span").css("width",a+"%")},inArray=function(a,b){for(var c=0;c<b.length;c++)if("string"==typeof b[c]&&b[c].toLowerCase()===a.toLowerCase())return!0;return!1},albumInArray=function(a,b){for(var c=[],d=null,e=b.albums,f=0;f<e.length;f++){try{d=new RegExp(e[f].name,"i")}catch(g){console.log(g);continue}e[f].match===!0&&"string"==typeof e[f].name&&null!==a.match(d)?(e[f].index=f,c.push(e[f])):"string"==typeof e[f].name&&a.toLowerCase()===e[f].name.toLowerCase()&&(e[f].index=f,c.push(e[f]))}return 0===c.length?!1:c},supportFullScreen=function(){return document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled},toggleFullScreen=function(a){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():a.requestFullscreen?a.requestFullscreen():a.msRequestFullscreen?a.msRequestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)};$.filo.getUrlParameter=function(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return decodeURIComponent(e[1])}},Date.now=Date.now||function(){return+new Date};

})( jQuery );