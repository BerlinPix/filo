/*
 * FILo <> Facebook Image Loader jQuery Plugin v1.1
 * http://www.berlinpix.com/filo
 *
 * Copyright 2014, BerlinPix.com
 * licensed under the LGPL license.
 *
 * Date: 2014-01-21
 */
(function(c){function s(b,a,c,f){if("function"==typeof f.before){var d=jQuery.Event("FILo Before Event");f.before(d)}d=b.filo.root_path;d=void 0==f.filo_loaderGraphic?d+b.filo.filo_loaderGraphicDefault:f.filo_loaderGraphic;if(null==b(".filo_loader")||0==b(".filo_loader").length){var h=new Image;h.onload=function(){b(h).css("marginTop",-1*(this.height/2));b(h).css("marginLeft",-1*(this.width/2));b("#"+String(a)).append(h)};h.setAttribute("class","filo_loader");h.src=d}var i=[];b.each(b("#"+String(a)).find(".excluded"),
function(a,c){i.push(b(c).attr("id"))});var g=[];b.each(b("#"+a).find(".album"),function(a,c){g.push(b(c).attr("id"))});if(void 0!=f.albums&&0<f.albums.length)for(d=0;d<f.albums.length;d++)g.push(decodeURI(f.albums[d]));if(void 0!=f.excluded&&0<f.excluded.length)for(d=0;d<f.excluded.length;d++)i.push(decodeURI(f.excluded[d]));var d="https://graph.facebook.com/fql?q=",j="",j=0<parseInt(c)?JSON.stringify({albums:"SELECT aid, name FROM album WHERE owner = "+c}):JSON.stringify({page_id:"SELECT page_id FROM page WHERE username = '"+
c+"'",albums:"SELECT aid, name FROM album WHERE owner IN (SELECT page_id FROM #page_id)"}),d=d+encodeURIComponent(j);b.browser.msie?b.ajax({url:d,dataType:"jsonp"}).success(function(e){e=e.data;v(b,a,c,1<e.length?e[1].fql_result_set:e[0].fql_result_set,g,i,f)}):b.getJSON(d,function(e){e=e.data;e=1<e.length?e[1].fql_result_set:e[0].fql_result_set;0>=e.length&&(b(".filo_loader").remove(),alert("There are no albums, please check your Facebook-ID"));v(b,a,c,e,g,i,f)}).error(function(){b(".filo_loader").remove();
alert("Error while loading, please check your Facebook-ID or write me: info@berlinpix.com")})}function v(b,a,c,f,d,h,i){b.filo.toLoad[a]=0;b.filo.isLoaded[a]=0;var g="";0<d.length?b.each(f,function(f,e){if(w(e.name,d)){b.filo.toLoad[a]+=1;var h=b.filo.maxCountDefault;void 0!=b("#"+a+" #"+e.name).attr("maxCount")?h=parseInt(b("#"+a+" #"+e.name).attr("maxCount")):void 0!=b("#"+a+" #"+e.name.toLowerCase()).attr("maxCount")?h=parseInt(b("#"+a+" #"+e.name.toLowerCase()).attr("maxCount")):void 0!=i&&void 0!=
i.maxCount&&(h=i.maxCount);g="all"==h?JSON.stringify({photos:"SELECT src, src_big FROM photo WHERE aid = '"+e.aid+"'"}):JSON.stringify({photos:"SELECT src, src_big FROM photo WHERE aid = '"+e.aid+"' LIMIT "+h});var p="https://graph.facebook.com/fql?q="+encodeURIComponent(g);b("#"+a+" #"+e.name).remove();b("#"+a+" #"+e.name.toLowerCase()).remove();var l=b('<div class="album" id="'+e.name+'"></div>').append('<div class="title">'+e.name+'</div><div class="thumbs"></div>');b(l).hide();b("#"+a).append(l);
b.browser.msie?b.ajax({url:p,dataType:"jsonp"}).success(function(e){r(1,b,c,a,e.data[0].fql_result_set,l,h,i)}):b.getJSON(p,function(e){r(1,b,c,a,e.data[0].fql_result_set,l,h,i)})}}):b.each(f,function(f,e){if(!w(e.name,h)){b.filo.toLoad[a]+=1;var d=b.filo.maxCountDefault;void 0!=i&&void 0!=i.maxCount?d=i.maxCount:void 0!=b("#"+e.name).attr("maxCount")&&(d=parseInt(b("#"+e.name).attr("maxCount")));g="all"==d?JSON.stringify({photos:"SELECT src, src_big FROM photo WHERE aid = '"+e.aid+"'"}):JSON.stringify({photos:"SELECT src, src_big FROM photo WHERE aid = '"+
e.aid+"' LIMIT "+d});var p="https://graph.facebook.com/fql?q="+encodeURIComponent(g),l=b('<div class="album" id="'+e.name+'"></div>').append('<div class="title">'+e.name+'</div><div class="thumbs"></div>').hide();b("#"+a).append(l);b.browser.msie?b.ajax({url:p,dataType:"jsonp"}).success(function(e){r(1,b,c,a,e.data[0].fql_result_set,l,d,i)}):b.getJSON(p,function(e){r(1,b,c,a,e.data[0].fql_result_set,l,d,i)})}})}function r(b,a,c,f,d,h,i,g){var j=1==b?1:26*(b-1),e=[],b=d,k=a.filo.root_path;if(void 0!=
g.order&&"reverse"==g.order)b.reverse();else if(void 0!=g.order&&"random"==g.order){for(var p=[],l=[];p.length<i&&p.length<b.length;){var q=Math.floor(Math.random()*b.length);void 0==l[q]&&(p.push(b[q]),l[q]=!0)}b=p}a.each(b,function(b,f){e[j-1]=f.src_big;var l=1==j?" first":"",p=j==i?" last":"",q=new Image;q.setAttribute("class","picture filo_picture");q.setAttribute("id",j-1);var r=0;q.onerror=function(){2>r?(console.log("load picture again: "+f.src),q.src=f.src,r++):(q.onerror=null,q.src=a.filo.root_path+
a.filo.defaultImage)};q.src=f.src;l=a('<div class="thumb thumb_'+j+l+p+'"><div class="inner"><a href="'+f.src_big+'"></a></div></div>');a(l).find("a").append(q);a(h).find(".thumbs").append(l);a(h).find(".filo_picture").unbind("click");a(h).find(".filo_picture").click(function(b){b.preventDefault();if(void 0!=g.href)return void 0!=g.method&&"post"==g.method.toLowerCase()?(b=!0==g.newWindow?'target="_blank"':"",a("body").append('<form id="filo_forward" '+b+' method="POST" action="'+g.href+'"><input name="profile" value="'+
c+'" /><input name="album" value="'+a(h).attr("id")+'" /></form>'),a("#filo_forward").trigger("submit").remove()):g.newWindow?window.open(g.href+"?profile="+c+"&album="+a(h).attr("id")):document.location=g.href+"?profile="+c+"&album="+a(h).attr("id"),!1;if(1>a(".filo_overlay").length){a.filo.closeButton=k+a.filo.closeButtons.black;void 0!=g.closeButton&&(a.filo.closeButton=void 0!=a.filo.closeButtons[g.closeButton]?k+a.filo.closeButtons[g.closeButton]:g.closeButton);var b=Math.max.apply(null,a.map(a("body > *"),
function(b){return parseInt(a(b).css("z-index"))?parseInt(a(b).css("z-index")):1})),f=void 0!=g.overlay?"background: "+g.overlay+"; ":"background: "+a.filo.overlayDefault+";",d=void 0!=g.overlayOpacity?" opacity: "+g.overlayOpacity+";":" opacity: "+a.filo.overlayOpacityDefault+";";a("body").append('<div class="filo_overlay" style="z-index:'+(b+1)+';" ><div class="filo_overlay_background" style="'+f+d+'"></div><div class="filo_overlay_container"><div class="filo_overlay_container_left"></div><div class="filo_overlay_container_right"></div><div class="picture_counter"></div></div></div>');
var i=new Image;i.onload=function(){a(".filo_overlay_container").append(i);var b=0<a(".filo_overlay_container").css("border-width")?a(".filo_overlay_container").css("border-width"):17;a(this).css("right",-1*(this.width/2+b));a(this).css("top",-1*(this.height/2+b));i.setAttribute("class","filo_overlay_container_close");a(".filo_overlay_container_close").click(function(){a(".filo_overlay").remove()})};i.src=a.filo.closeButton;t(a,a(this).attr("id"),e,a(h).attr("id"),g);a(".filo_overlay_background").click(function(b){"filo_overlay_background"==
a(b.target).attr("class")&&a(".filo_overlay").remove()});a(".filo_overlay_container_left").click(function(){var b=parseInt(a(".filo_full_picture").attr("id"));0<b&&t(a,b-1,e,a(h).attr("id"),g)});a(".filo_overlay_container_right").click(function(){var b=parseInt(a(".filo_full_picture").attr("id"));b<e.length-1&&t(a,b+1,e,a(h).attr("id"),g)});a(".filo_overlay_container_left").mouseenter(function(){a(this).css("backgroundColor","none").css("background-image","url('"+k+"/img/left_white.png')").css("background-repeat",
"no-repeat").css("background-position","left center")}).mouseout(function(){a(this).css("background-image","")});a(".filo_overlay_container_right").mouseenter(function(){a(this).css("backgroundColor","none").css("background-image","url('"+k+"/img/right_white.png')").css("background-repeat","no-repeat").css("background-position","right center")}).mouseout(function(){a(this).css("background-image","")})}});if(j>=i)return a(h).append('<div class="clear"></div>'),!1;j++;j==d.length&&a(h).append('<div class="clear"></div>')});
a.filo.isLoaded[f]+=1;a(h).fadeIn("slow");a.filo.isLoaded[f]==a.filo.toLoad[f]&&(a("#"+f+" .album").last().attr("class",a("#"+f+" .album").last().attr("class")+" last"),a("#"+f).append('<div class="clear"></div>'),a("#"+f+" .add").remove(),a("#"+f+" .excluded").remove(),a("#"+f+" .filo_loader").remove(),"function"==typeof g.load&&(f=jQuery.Event("FILo Load Event"),g.load(f)))}function t(b,a,c,f,d){b(".filo_overlay_container_left").show();b(".filo_overlay_container_right").show();0==a&&b(".filo_overlay_container_left").hide();
a==c.length-1&&b(".filo_overlay_container_right").hide();var h=parseInt(b(".filo_overlay_container").css("border-top-width").split("px")[0]),i=parseInt(b(".picture_counter").height()),g=(d.maxWidth?d.maxWidth:b.filo.maxWidth)/100,d=(d.maxHeight?d.maxHeight:b.filo.maxHeight)/100,j=b(window).width()*g-h,e=b(window).height()*d-(h+i),k=new Image;k.onload=function(){var d=this.width,g=this.height,h,m;d>g?(h=d>j?j:d,m=h*g/d,m>e&&(m=g>e?e:g,h=m*d/g)):(m=g>e?e:g,h=m*d/g,h>j&&(h=d>j?j:d,m=h*g/d));0<b(".filo_overlay_container .filo_full_picture").length?
b(".filo_overlay_container .filo_full_picture").fadeOut(300,function(){b(k).css("display","none");k.width=h;k.height=m;b(".filo_overlay_container").width(h).height(m).css("margin-left",-1*(h/2)).css("margin-top",-1*(m/2)-i).prepend(k).find(k).fadeIn(300);b(this).remove();b(".filo_overlay_container_close").show();b(".filo_overlay_container .picture_counter").html("<span>Album: "+f+" | Pic: "+(parseInt(a)+1)+" of "+c.length+"</span>")}):(b(k).width(h).height(m),b(".filo_overlay_container").width(h).height(m).css("margin-left",
-1*(h/2)).css("margin-top",-1*(m/2)-i).prepend(k).fadeIn(300),b(".filo_overlay_container_close").show(),b(".filo_overlay_container .picture_counter").html("<span>Album: "+f+" | Pic: "+(parseInt(a)+1)+" of "+c.length+"</span>"))};k.setAttribute("class","filo_full_picture");k.setAttribute("id",a);k.src=c[a]}function u(b,a){if(0<b(".filo_overlay").length&&!b.filo.resize){b(".filo_full_picture").css("width","").css("height","");resize=!0;var c=(a.maxWidth?a.maxWidth:b.filo.maxWidth)/100,f=(a.maxHeight?
a.maxHeight:b.filo.maxHeight)/100;console.log(c);console.log(f);var d=parseInt(b(".filo_overlay_container").css("border-top-width").split("px")[0]),h=parseInt(b(".picture_counter").height()),c=b(window).width()*c-d,f=b(window).height()*f-(d+h),d=parseInt(b(".filo_full_picture").width()),i=parseInt(b(".filo_full_picture").height()),g,j;d>i?(g=d>c?c:d,j=g*i/d,j>f&&(j=i>f?f:i,g=j*d/i)):(j=i>f?f:i,g=j*d/i,g>c&&(g=d>c?c:d,j=g*i/d));b(".filo_overlay_container img.filo_full_picture").width(g);b(".filo_overlay_container").width(g).height(j).css("margin-left",
-1*(g/2)).css("margin-top",-1*(j/2)-h);resize=!1}}function w(b,a){for(var c=0;c<a.length;c++)if(b.toLowerCase()==a[c].toLowerCase())return!0;return!1}c.fn.filo=function(b){if(c(this).length){void 0==b&&(b={container:this});-1==(void 0!=c(this).attr("class")&&c(this).attr("class").indexOf("template"))&&void 0!=b.template?c(this).addClass("template_"+b.template+" filo"):c(this).addClass("filo");var a=c(this).attr("id"),n=a+"_"+Date.now(),n=n.replace(".","");c(this).attr("id",n);s(c,n,a,b);c(window).unbind("resize");
c(window).resize(function(){u(c,b)})}else console.log("filo container is undefined, please check the ID or class name")};c.filo=function(b,a){void 0==a?a={container:"body"}:void 0==a.container&&(a.container="body");var n=b+"_"+Date.now(),n=n.replace(".",""),f=void 0!=a.template?"template_"+a.template:"";c(a.container).append('<div class="filo '+f+'" id="'+n+'"></div>');s(c,n,b,a);c(window).unbind("resize");c(window).resize(function(){u(c,a)})};jQuery.filo.getUrlParams=function(){for(var b=[],a,c=
window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),f=0;f<c.length;f++)a=c[f].split("="),b.push(a[0]),b[a[0]]=a[1];return b};c(document).ready(function(){c.filo.toLoad=[];c.filo.isLoaded=[];c.filo.maxCountDefault=3;c.filo.overlayDefault="rgb(177,177,177)";c.filo.overlayOpacityDefault=0.5;c.filo.filo_loaderGraphicDefault="/img/bpx_loader.gif";c.filo.photos_array=null;c.filo.resize=!1;c.filo.closeButtons={black:"/img/close_black.png",white:"/img/close_white.png"};c.filo.defaultImage=
"/img/default.png";c.filo.order=["normal","reverse","random"];c.filo.method="post";c.filo.newWindow=!1;var b=c.filo,a;a:{try{throw Error();}catch(n){var f="";void 0!=n.fileName?f=n.fileName.split("/"):(a=document.getElementsByTagName("script"),c.each(a,function(b,a){0<=a.src.indexOf("filo.js")&&(f=a.src.split("/"))}));if(""==f){a="filo/";break a}}a="";for(var d=0;d<f.length-1;d++)a=d<f.length-2?a+(f[d]+"/"):a+f[d]}b.root_path=a;c.filo.ie=!1;c.support.cors=!0;c.filo.maxHeight=90;c.filo.maxWidth=90;
var h=[];c.each(c(".filo"),function(b,a){var d=c(a).attr("id"),e=d+"_"+Date.now()+"_"+Math.round(1E5*Math.random()),e=e.replace(".","");c(a).attr("id",e);void 0!=c("#"+e).attr("maxCount")&&(h.maxCount=c("#"+e).attr("maxCount"));void 0!=c("#"+e).attr("href")&&(h.href=c("#"+e).attr("href"));void 0!=c("#"+e).attr("newWindow")&&(h.newWindow="true"==c("#"+e).attr("newWindow")?!0:!1);h.method=void 0!=c("#"+e).attr("method")?c("#"+e).attr("method"):"post";s(c,e,d,h);c(window).unbind("resize");c(window).resize(function(){u(c,
h)})})});"undefined"==typeof c.browser&&(c.browser={msie:"Microsoft Internet Explorer"==navigator.appName});Date.now=Date.now||function(){return+new Date}})(jQuery);
