/*
 * FILo <> Facebook Image Loader jQuery Plugin v1.1
 * http://www.berlinpix.com/filo
 *
 * Copyright 2013, BerlinPix.com
 * licensed under the LGPL license.
 *
 * Date: 2013-05-02
 */
var filo_jQuery=jQuery.noConflict();filo_jQuery.fn.filo=function(b){if(filo_jQuery(this).length){void 0==b&&(b={container:this});-1==(void 0!=filo_jQuery(this).attr("class")&&filo_jQuery(this).attr("class").indexOf("template"))&&void 0!=b.template?filo_jQuery(this).addClass("template_"+b.template+" filo"):filo_jQuery(this).addClass("filo");var a=filo_jQuery(this).attr("id"),e=a+"_"+Date.now(),e=e.replace(".","");filo_jQuery(this).attr("id",e);filoHandler(filo_jQuery,e,a,b)}else console.log("filo container is undefined, please check the ID or class name")};
filo_jQuery.filo=function(b,a){void 0==a?a={container:"body"}:void 0==a.container&&(a.container="body");var e=b+"_"+Date.now(),e=e.replace(".",""),c=void 0!=a.template?"template_"+a.template:"";filo_jQuery(a.container).append('<div class="filo '+c+'" id="'+e+'"></div>');filoHandler(filo_jQuery,e,b,a)};jQuery.filo.getUrlParams=function(){for(var b=[],a,e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),c=0;c<e.length;c++)a=e[c].split("="),b.push(a[0]),b[a[0]]=a[1];return b};
function getUrlParams(){for(var b=[],a,e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),c=0;c<e.length;c++)a=e[c].split("="),b.push(a[0]),b[a[0]]=a[1];return b}
filo_jQuery(document).ready(function(){filo_jQuery.filo.toLoad=[];filo_jQuery.filo.isLoaded=[];filo_jQuery.filo.maxCountDefault=3;filo_jQuery.filo.overlayDefault="rgb(177,177,177)";filo_jQuery.filo.overlayOpacityDefault=0.5;filo_jQuery.filo.filo_loaderGraphicDefault="/img/bpx_loader.gif";filo_jQuery.filo.photos_array=null;filo_jQuery.filo.resize=!1;filo_jQuery.filo.closeButtons={black:"/img/close_black.png",white:"/img/close_white.png"};filo_jQuery.filo.order=["normal","reverse","random"];filo_jQuery.filo.root_path=
getRootPath();filo_jQuery.filo.ie=!1;filo_jQuery.support.cors=!0;filo_jQuery.each(filo_jQuery(".filo"),function(b,a){var e=filo_jQuery(a).attr("id"),c=e+"_"+Date.now()+"_"+Math.round(1E5*Math.random()),c=c.replace(".","");filo_jQuery(a).attr("id",c);var d=[];void 0!=filo_jQuery("#"+c).attr("maxCount")&&(d.maxCount=filo_jQuery("#"+c).attr("maxCount"));void 0!=filo_jQuery("#"+c).attr("href")&&(d.href=filo_jQuery("#"+c).attr("href"));d.method=void 0!=filo_jQuery("#"+c).attr("method")?filo_jQuery("#"+
c).attr("method"):"post";filoHandler(filo_jQuery,c,e,d)});filo_jQuery(window).resize(function(){resizeImage(filo_jQuery)})});
function filoHandler(b,a,e,c){if("function"==typeof c.before){var d=jQuery.Event("FILo Before Event");c.before(d)}d=b.filo.root_path;d=void 0==c.filo_loaderGraphic?d+b.filo.filo_loaderGraphicDefault:c.filo_loaderGraphic;if(null==b(".filo_loader")||0==b(".filo_loader").length){var i=new Image;i.onload=function(){b(i).css("marginTop",-1*(this.height/2));b(i).css("marginLeft",-1*(this.width/2));b("#"+String(a)).append(i)};i.setAttribute("class","filo_loader");i.src=d}var g=[];b.each(b("#"+String(a)).find(".excluded"),
function(a,c){g.push(b(c).attr("id"))});var f=[];b.each(b("#"+a).find(".album"),function(a,c){f.push(b(c).attr("id"))});if(void 0!=c.albums&&0<c.albums.length)for(d=0;d<c.albums.length;d++)f.push(decodeURI(c.albums[d]));if(void 0!=c.excluded&&0<c.excluded.length)for(d=0;d<c.excluded.length;d++)g.push(decodeURI(c.excluded[d]));var d="https://graph.facebook.com/fql?q=",l="",l=isInt(e)?JSON.stringify({albums:"SELECT aid, name FROM album WHERE owner = "+e}):JSON.stringify({page_id:"SELECT page_id FROM page WHERE username = 'kontrastspiel'",
albums:"SELECT aid, name FROM album WHERE owner IN (SELECT page_id FROM #page_id)"}),d=d+encodeURIComponent(l);b.browser.msie?b.ajax({url:d,dataType:"jsonp"}).success(function(h){h=h.data;handleAlbum(b,a,e,1<h.length?h[1].fql_result_set:h[0].fql_result_set,f,g,c)}):b.getJSON(d,function(h){h=h.data;h=1<h.length?h[1].fql_result_set:h[0].fql_result_set;0>=h.length&&(b(".filo_loader").remove(),alert("There are no albums, please check your Facebook-ID"));handleAlbum(b,a,e,h,f,g,c)}).error(function(){b(".filo_loader").remove();
alert("Error while loading, please check your Facebook-ID or write me: info@berlinpix.com")})}
function handleAlbum(b,a,e,c,d,i,g){b.filo.toLoad[a]=0;b.filo.isLoaded[a]=0;var f="";0<d.length?b.each(c,function(c,h){if(inArray(h.name,d)){b.filo.toLoad[a]+=1;f=JSON.stringify({photos:"SELECT src, src_big FROM photo WHERE aid = '"+h.aid+"'"});var i="https://graph.facebook.com/fql?q="+encodeURIComponent(f),j=b.filo.maxCountDefault;void 0!=b("#"+a+" #"+h.name).attr("maxCount")?j=parseInt(b("#"+a+" #"+h.name).attr("maxCount")):void 0!=b("#"+a+" #"+h.name.toLowerCase()).attr("maxCount")?j=parseInt(b("#"+
a+" #"+h.name.toLowerCase()).attr("maxCount")):void 0!=g&&void 0!=g.maxCount&&(j=g.maxCount);b("#"+a+" #"+h.name).remove();b("#"+a+" #"+h.name.toLowerCase()).remove();var k=b('<div class="album" id="'+h.name+'"></div>').append('<div class="title">'+h.name+'</div><div class="thumbs"></div>');b(k).hide();b("#"+a).append(k);b.browser.msie?b.ajax({url:i,dataType:"jsonp"}).success(function(c){handlePhoto(1,b,e,a,c.data[0].fql_result_set,k,j,g)}):b.getJSON(i,function(c){handlePhoto(1,b,e,a,c.data[0].fql_result_set,
k,j,g)})}}):b.each(c,function(c,h){if(!inArray(h.name,i)){b.filo.toLoad[a]+=1;f=JSON.stringify({photos:"SELECT src, src_big FROM photo WHERE aid = '"+h.aid+"'"});var d="https://graph.facebook.com/fql?q="+encodeURIComponent(f),j=b.filo.maxCountDefault;void 0!=g&&void 0!=g.maxCount?j=g.maxCount:void 0!=b("#"+h.name).attr("maxCount")&&(j=parseInt(b("#"+h.name).attr("maxCount")));var k=b('<div class="album" id="'+h.name+'"></div>').append('<div class="title">'+h.name+'</div><div class="thumbs"></div>').hide();
b("#"+a).append(k);b.browser.msie?b.ajax({url:d,dataType:"jsonp"}).success(function(c){handlePhoto(1,b,e,a,c.data[0].fql_result_set,k,j,g)}):b.getJSON(d,function(c){handlePhoto(1,b,e,a,c.data[0].fql_result_set,k,j,g)})}})}
function handlePhoto(b,a,e,c,d,i,g,f){var l=1==b?1:26*(b-1),h=[],b=d,m=a.filo.root_path;if(void 0!=f.order&&"reverse"==f.order)b.reverse();else if(void 0!=f.order&&"random"==f.order){for(var j=[],k=[];j.length<g&&j.length<b.length;){var n=Math.floor(Math.random()*b.length);void 0==k[n]&&(j.push(b[n]),k[n]=!0)}b=j}a.each(b,function(b,c){h[l-1]=c.src_big;var j=a('<div class="thumb thumb_'+l+(1==l?" first":"")+(l==g?" last":"")+'"><div class="inner"><a href="'+c.src_big+'"><img id="'+(l-1)+'" class="picture filo_picture" src="'+
c.src+'"/></a></div></div>');a(j).find("img").load(function(){}).error(function(){console.log("loading image again");a(j).find("img").attr("src",a(j).attr("src"))});a(i).find(".thumbs").append(j);a(i).find(".filo_picture").click(function(b){b.preventDefault();if(void 0!=f.href)return"post"==f.method.toLowerCase()?(a("body").append('<form id="filo_forward" method="POST" action="'+f.href+'"><input name="profile" value="'+e+'" /><input name="album" value="'+a(i).attr("id")+'" /></form>'),a("#filo_forward").trigger("submit").remove()):
document.location=f.href+"?profile="+e+"&album="+a(i).attr("id"),!1;if(1>a(".filo_overlay").length){a.filo.closeButton=m+a.filo.closeButtons.black;void 0!=f.closeButton&&(a.filo.closeButton=void 0!=a.filo.closeButtons[f.closeButton]?m+a.filo.closeButtons[f.closeButton]:f.closeButton);var b=Math.max.apply(null,a.map(a("body > *"),function(b){return parseInt(a(b).css("z-index"))?parseInt(a(b).css("z-index")):1})),c=void 0!=f.overlay?"background: "+f.overlay+"; ":"background: "+a.filo.overlayDefault+
";",d=void 0!=f.overlayOpacity?" opacity: "+f.overlayOpacity+";":" opacity: "+a.filo.overlayOpacityDefault+";";a("body").append('<div class="filo_overlay" style="z-index:'+(b+1)+';" ><div class="filo_overlay_background" style="'+c+d+'"></div><div class="filo_overlay_container"><div class="filo_overlay_container_left"></div><div class="filo_overlay_container_right"></div><div class="picture_counter"></div></div></div>');var g=new Image;g.onload=function(){a(".filo_overlay_container").append(g);var b=
0<a(".filo_overlay_container").css("border-width")?a(".filo_overlay_container").css("border-width"):17;a(this).css("right",-1*(this.width/2+b));a(this).css("top",-1*(this.height/2+b));g.setAttribute("class","filo_overlay_container_close");a(".filo_overlay_container_close").click(function(){a(".filo_overlay").remove()})};g.src=a.filo.closeButton;setNewImage(a,a(this).attr("id"),h,a(i).attr("id"));a(".filo_overlay_background").click(function(b){"filo_overlay_background"==a(b.target).attr("class")&&
a(".filo_overlay").remove()});a(".filo_overlay_container_left").click(function(){var b=parseInt(a(".filo_full_picture").attr("id"));0<b&&setNewImage(a,b-1,h,a(i).attr("id"))});a(".filo_overlay_container_right").click(function(){var b=parseInt(a(".filo_full_picture").attr("id"));b<h.length-1&&setNewImage(a,b+1,h,a(i).attr("id"))});a(".filo_overlay_container_left").mouseenter(function(){a(this).css("backgroundColor","none").css("background-image","url('"+m+"/img/left_white.png')").css("background-repeat",
"no-repeat").css("background-position","left center")}).mouseout(function(){a(this).css("background-image","")});a(".filo_overlay_container_right").mouseenter(function(){a(this).css("backgroundColor","none").css("background-image","url('"+m+"/img/right_white.png')").css("background-repeat","no-repeat").css("background-position","right center")}).mouseout(function(){a(this).css("background-image","")})}});if(l>=g)return a(i).append('<div class="clear"></div>'),!1;l++;l==d.length&&a(i).append('<div class="clear"></div>')});
a.filo.isLoaded[c]+=1;a(i).fadeIn("slow");a.filo.isLoaded[c]==a.filo.toLoad[c]&&(a("#"+c+" .album").last().attr("class",a("#"+c+" .album").last().attr("class")+" last"),a("#"+c).append('<div class="clear"></div>'),a("#"+c+" .add").remove(),a("#"+c+" .excluded").remove(),a("#"+c+" .filo_loader").remove(),"function"==typeof f.load&&(c=jQuery.Event("FILo Load Event"),f.load(c)))}
function setNewImage(b,a,e,c){b(".filo_overlay_container_left").show();b(".filo_overlay_container_right").show();0==a&&b(".filo_overlay_container_left").hide();a==e.length-1&&b(".filo_overlay_container_right").hide();var d=parseInt(b(".filo_overlay_container").css("border-top-width").split("px")[0]),i=parseInt(b(".picture_counter").height()),g=0.9*b(window).width()-d,f=0.9*b(window).height()-(d+i),l=new Image;l.onload=function(){var d=this.width,m=this.height,j,k;d>m?(j=d>g?g:d,k=j*m/d,k>f&&(k=m>
f?f:m,j=k*d/m)):(k=m>f?f:m,j=k*d/m,j>g&&(j=d>g?g:d,k=j*m/d));0<b(".filo_overlay_container .filo_full_picture").length?b(".filo_overlay_container .filo_full_picture").fadeOut(300,function(){b(l).css("display","none");l.width=j;l.height=k;b(".filo_overlay_container").width(j).height(k).css("margin-left",-1*(j/2)).css("margin-top",-1*(k/2)-i).prepend(l).find(l).fadeIn(300);b(this).remove();b(".filo_overlay_container_close").show();b(".filo_overlay_container .picture_counter").html("<span>Album: "+c+
" | Pic: "+(parseInt(a)+1)+" of "+e.length+"</span>")}):(b(l).width(j).height(k),b(".filo_overlay_container").width(j).height(k).css("margin-left",-1*(j/2)).css("margin-top",-1*(k/2)-i).prepend(l).fadeIn(300),b(".filo_overlay_container_close").show(),b(".filo_overlay_container .picture_counter").html("<span>Album: "+c+" | Pic: "+(parseInt(a)+1)+" of "+e.length+"</span>"))};l.setAttribute("class","filo_full_picture");l.setAttribute("id",a);l.src=e[a]}
function resizeImage(b){if(0<b(".filo_overlay").length&&!b.filo.resize){b(".filo_full_picture").css("width","").css("height","");resize=!0;var a=parseInt(b(".filo_overlay_container").css("border-top-width").split("px")[0]),e=parseInt(b(".picture_counter").height()),c=0.9*b(window).width()-a,a=0.9*b(window).height()-(a+e),d=parseInt(b(".filo_full_picture").width()),i=parseInt(b(".filo_full_picture").height()),g,f;d>i?(g=d>c?c:d,f=g*i/d,f>a&&(f=i>a?a:i,g=f*d/i)):(f=i>a?a:i,g=f*d/i,g>c&&(g=d>c?c:d,f=
g*i/d));b(".filo_overlay_container img.filo_full_picture").width(g);b(".filo_overlay_container").width(g).height(f).css("margin-left",-1*(g/2)).css("margin-top",-1*(f/2)-e);resize=!1}}function inArray(b,a){for(var e=0;e<a.length;e++)if(b.toLowerCase()==a[e].toLowerCase())return!0;return!1}
function getRootPath(){try{throw Error();}catch(b){var a="";if(void 0!=b.fileName)a=b.fileName.split("/");else{var e=document.getElementsByTagName("script");filo_jQuery.each(e,function(b,c){0<=c.src.indexOf("filo.js")&&(a=c.src.split("/"))})}if(""==a)return"filo/"}for(var e="",c=0;c<a.length-1;c++)e=c<a.length-2?e+(a[c]+"/"):e+a[c];return e}function isInt(b){return"number"===typeof b&&0==b%1};
