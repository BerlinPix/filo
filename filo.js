/*
 * FILo <> Facebook Image Loader jQuery Plugin v1.1
 * http://www.berlinpix.com/filo
 *
 * Copyright 2013, BerlinPix.com
 * licensed under the LGPL license.
 *
 * Date: 2013-06-10
 */
var filo_jQuery=jQuery.noConflict();
filo_jQuery.fn.filo=function(a){if(filo_jQuery(this).length){void 0==a&&(a={container:this});-1==(void 0!=filo_jQuery(this).attr("class")&&filo_jQuery(this).attr("class").indexOf("template"))&&void 0!=a.template?filo_jQuery(this).addClass("template_"+a.template+" filo"):filo_jQuery(this).addClass("filo");var b=filo_jQuery(this).attr("id"),e=b+"_"+Date.now(),e=e.replace(".","");filo_jQuery(this).attr("id",e);filoHandler(filo_jQuery,e,b,a);filo_jQuery(window).unbind("resize");filo_jQuery(window).resize(function(){resizeImage(filo_jQuery,
a)})}else console.log("filo container is undefined, please check the ID or class name")};filo_jQuery.filo=function(a,b){void 0==b?b={container:"body"}:void 0==b.container&&(b.container="body");var e=a+"_"+Date.now(),e=e.replace(".",""),d=void 0!=b.template?"template_"+b.template:"";filo_jQuery(b.container).append('<div class="filo '+d+'" id="'+e+'"></div>');filoHandler(filo_jQuery,e,a,b);filo_jQuery(window).unbind("resize");filo_jQuery(window).resize(function(){resizeImage(filo_jQuery,b)})};
jQuery.filo.getUrlParams=function(){for(var a=[],b,e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<e.length;d++)b=e[d].split("="),a.push(b[0]),a[b[0]]=b[1];return a};function getUrlParams(){for(var a=[],b,e=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),d=0;d<e.length;d++)b=e[d].split("="),a.push(b[0]),a[b[0]]=b[1];return a}
filo_jQuery(document).ready(function(){filo_jQuery.filo.toLoad=[];filo_jQuery.filo.isLoaded=[];filo_jQuery.filo.maxCountDefault=3;filo_jQuery.filo.overlayDefault="rgb(177,177,177)";filo_jQuery.filo.overlayOpacityDefault=0.5;filo_jQuery.filo.filo_loaderGraphicDefault="/img/bpx_loader.gif";filo_jQuery.filo.photos_array=null;filo_jQuery.filo.resize=!1;filo_jQuery.filo.closeButtons={black:"/img/close_black.png",white:"/img/close_white.png"};filo_jQuery.filo.defaultImage="/img/default.png";filo_jQuery.filo.order=
["normal","reverse","random"];filo_jQuery.filo.root_path=getRootPath();filo_jQuery.filo.ie=!1;filo_jQuery.support.cors=!0;filo_jQuery.filo.maxHeight=90;filo_jQuery.filo.maxWidth=90;var a=[];filo_jQuery.each(filo_jQuery(".filo"),function(b,e){var d=filo_jQuery(e).attr("id"),c=d+"_"+Date.now()+"_"+Math.round(1E5*Math.random()),c=c.replace(".","");filo_jQuery(e).attr("id",c);void 0!=filo_jQuery("#"+c).attr("maxCount")&&(a.maxCount=filo_jQuery("#"+c).attr("maxCount"));void 0!=filo_jQuery("#"+c).attr("href")&&
(a.href=filo_jQuery("#"+c).attr("href"));a.method=void 0!=filo_jQuery("#"+c).attr("method")?filo_jQuery("#"+c).attr("method"):"post";filoHandler(filo_jQuery,c,d,a);filo_jQuery(window).unbind("resize");filo_jQuery(window).resize(function(){resizeImage(filo_jQuery,a)})})});
function filoHandler(a,b,e,d){if("function"==typeof d.before){var c=jQuery.Event("FILo Before Event");d.before(c)}c=a.filo.root_path;c=void 0==d.filo_loaderGraphic?c+a.filo.filo_loaderGraphicDefault:d.filo_loaderGraphic;if(null==a(".filo_loader")||0==a(".filo_loader").length){var g=new Image;g.onload=function(){a(g).css("marginTop",-1*(this.height/2));a(g).css("marginLeft",-1*(this.width/2));a("#"+String(b)).append(g)};g.setAttribute("class","filo_loader");g.src=c}var h=[];a.each(a("#"+String(b)).find(".excluded"),
function(b,d){h.push(a(d).attr("id"))});var f=[];a.each(a("#"+b).find(".album"),function(b,d){f.push(a(d).attr("id"))});if(void 0!=d.albums&&0<d.albums.length)for(c=0;c<d.albums.length;c++)f.push(decodeURI(d.albums[c]));if(void 0!=d.excluded&&0<d.excluded.length)for(c=0;c<d.excluded.length;c++)h.push(decodeURI(d.excluded[c]));var c="https://graph.facebook.com/fql?q=",j="",j=0<parseInt(e)?JSON.stringify({albums:"SELECT aid, name FROM album WHERE owner = "+e}):JSON.stringify({page_id:"SELECT page_id FROM page WHERE username = '"+
e+"'",albums:"SELECT aid, name FROM album WHERE owner IN (SELECT page_id FROM #page_id)"}),c=c+encodeURIComponent(j);a.browser.msie?a.ajax({url:c,dataType:"jsonp"}).success(function(c){c=c.data;handleAlbum(a,b,e,1<c.length?c[1].fql_result_set:c[0].fql_result_set,f,h,d)}):a.getJSON(c,function(c){c=c.data;c=1<c.length?c[1].fql_result_set:c[0].fql_result_set;0>=c.length&&(a(".filo_loader").remove(),alert("There are no albums, please check your Facebook-ID"));handleAlbum(a,b,e,c,f,h,d)}).error(function(){a(".filo_loader").remove();
alert("Error while loading, please check your Facebook-ID or write me: info@berlinpix.com")})}
function handleAlbum(a,b,e,d,c,g,h){a.filo.toLoad[b]=0;a.filo.isLoaded[b]=0;var f="";0<c.length?a.each(d,function(d,k){if(inArray(k.name,c)){a.filo.toLoad[b]+=1;var i=a.filo.maxCountDefault;void 0!=a("#"+b+" #"+k.name).attr("maxCount")?i=parseInt(a("#"+b+" #"+k.name).attr("maxCount")):void 0!=a("#"+b+" #"+k.name.toLowerCase()).attr("maxCount")?i=parseInt(a("#"+b+" #"+k.name.toLowerCase()).attr("maxCount")):void 0!=h&&void 0!=h.maxCount&&(i=h.maxCount);f="all"==i?JSON.stringify({photos:"SELECT src, src_big FROM photo WHERE aid = '"+
k.aid+"'"}):JSON.stringify({photos:"SELECT src, src_big FROM photo WHERE aid = '"+k.aid+"' LIMIT "+i});var g="https://graph.facebook.com/fql?q="+encodeURIComponent(f);a("#"+b+" #"+k.name).remove();a("#"+b+" #"+k.name.toLowerCase()).remove();var l=a('<div class="album" id="'+k.name+'"></div>').append('<div class="title">'+k.name+'</div><div class="thumbs"></div>');a(l).hide();a("#"+b).append(l);a.browser.msie?a.ajax({url:g,dataType:"jsonp"}).success(function(c){handlePhoto(1,a,e,b,c.data[0].fql_result_set,
l,i,h)}):a.getJSON(g,function(c){handlePhoto(1,a,e,b,c.data[0].fql_result_set,l,i,h)})}}):a.each(d,function(c,d){if(!inArray(d.name,g)){a.filo.toLoad[b]+=1;var i=a.filo.maxCountDefault;void 0!=h&&void 0!=h.maxCount?i=h.maxCount:void 0!=a("#"+d.name).attr("maxCount")&&(i=parseInt(a("#"+d.name).attr("maxCount")));f="all"==i?JSON.stringify({photos:"SELECT src, src_big FROM photo WHERE aid = '"+d.aid+"'"}):JSON.stringify({photos:"SELECT src, src_big FROM photo WHERE aid = '"+d.aid+"' LIMIT "+i});var p=
"https://graph.facebook.com/fql?q="+encodeURIComponent(f),l=a('<div class="album" id="'+d.name+'"></div>').append('<div class="title">'+d.name+'</div><div class="thumbs"></div>').hide();a("#"+b).append(l);a.browser.msie?a.ajax({url:p,dataType:"jsonp"}).success(function(c){handlePhoto(1,a,e,b,c.data[0].fql_result_set,l,i,h)}):a.getJSON(p,function(c){handlePhoto(1,a,e,b,c.data[0].fql_result_set,l,i,h)})}})}
function handlePhoto(a,b,e,d,c,g,h,f){var j=1==a?1:26*(a-1),k=[],a=c,i=b.filo.root_path;if(void 0!=f.order&&"reverse"==f.order)a.reverse();else if(void 0!=f.order&&"random"==f.order){for(var p=[],l=[];p.length<h&&p.length<a.length;){var n=Math.floor(Math.random()*a.length);void 0==l[n]&&(p.push(a[n]),l[n]=!0)}a=p}b.each(a,function(a,d){k[j-1]=d.src_big;var l=1==j?" first":"",p=j==h?" last":"",n=new Image;n.setAttribute("class","picture filo_picture");n.setAttribute("id",j-1);var q=0;n.onerror=function(){2>
q?(console.log("load picture again: "+d.src),n.src=d.src,q++):(n.onerror=null,n.src=b.filo.root_path+b.filo.defaultImage)};n.src=d.src;l=b('<div class="thumb thumb_'+j+l+p+'"><div class="inner"><a href="'+d.src_big+'"></a></div></div>');b(l).find("a").append(n);b(g).find(".thumbs").append(l);b(g).find(".filo_picture").click(function(a){a.preventDefault();if(void 0!=f.href)return"post"==f.method.toLowerCase()?(b("body").append('<form id="filo_forward" method="POST" action="'+f.href+'"><input name="profile" value="'+
e+'" /><input name="album" value="'+b(g).attr("id")+'" /></form>'),b("#filo_forward").trigger("submit").remove()):document.location=f.href+"?profile="+e+"&album="+b(g).attr("id"),!1;if(1>b(".filo_overlay").length){b.filo.closeButton=i+b.filo.closeButtons.black;void 0!=f.closeButton&&(b.filo.closeButton=void 0!=b.filo.closeButtons[f.closeButton]?i+b.filo.closeButtons[f.closeButton]:f.closeButton);var a=Math.max.apply(null,b.map(b("body > *"),function(a){return parseInt(b(a).css("z-index"))?parseInt(b(a).css("z-index")):
1})),d=void 0!=f.overlay?"background: "+f.overlay+"; ":"background: "+b.filo.overlayDefault+";",c=void 0!=f.overlayOpacity?" opacity: "+f.overlayOpacity+";":" opacity: "+b.filo.overlayOpacityDefault+";";b("body").append('<div class="filo_overlay" style="z-index:'+(a+1)+';" ><div class="filo_overlay_background" style="'+d+c+'"></div><div class="filo_overlay_container"><div class="filo_overlay_container_left"></div><div class="filo_overlay_container_right"></div><div class="picture_counter"></div></div></div>');
var h=new Image;h.onload=function(){b(".filo_overlay_container").append(h);var a=0<b(".filo_overlay_container").css("border-width")?b(".filo_overlay_container").css("border-width"):17;b(this).css("right",-1*(this.width/2+a));b(this).css("top",-1*(this.height/2+a));h.setAttribute("class","filo_overlay_container_close");b(".filo_overlay_container_close").click(function(){b(".filo_overlay").remove()})};h.src=b.filo.closeButton;setNewImage(b,b(this).attr("id"),k,b(g).attr("id"),f);b(".filo_overlay_background").click(function(a){"filo_overlay_background"==
b(a.target).attr("class")&&b(".filo_overlay").remove()});b(".filo_overlay_container_left").click(function(){var a=parseInt(b(".filo_full_picture").attr("id"));0<a&&setNewImage(b,a-1,k,b(g).attr("id"),f)});b(".filo_overlay_container_right").click(function(){var a=parseInt(b(".filo_full_picture").attr("id"));a<k.length-1&&setNewImage(b,a+1,k,b(g).attr("id"),f)});b(".filo_overlay_container_left").mouseenter(function(){b(this).css("backgroundColor","none").css("background-image","url('"+i+"/img/left_white.png')").css("background-repeat",
"no-repeat").css("background-position","left center")}).mouseout(function(){b(this).css("background-image","")});b(".filo_overlay_container_right").mouseenter(function(){b(this).css("backgroundColor","none").css("background-image","url('"+i+"/img/right_white.png')").css("background-repeat","no-repeat").css("background-position","right center")}).mouseout(function(){b(this).css("background-image","")})}});if(j>=h)return b(g).append('<div class="clear"></div>'),!1;j++;j==c.length&&b(g).append('<div class="clear"></div>')});
b.filo.isLoaded[d]+=1;b(g).fadeIn("slow");b.filo.isLoaded[d]==b.filo.toLoad[d]&&(b("#"+d+" .album").last().attr("class",b("#"+d+" .album").last().attr("class")+" last"),b("#"+d).append('<div class="clear"></div>'),b("#"+d+" .add").remove(),b("#"+d+" .excluded").remove(),b("#"+d+" .filo_loader").remove(),"function"==typeof f.load&&(d=jQuery.Event("FILo Load Event"),f.load(d)))}
function setNewImage(a,b,e,d,c){a(".filo_overlay_container_left").show();a(".filo_overlay_container_right").show();0==b&&a(".filo_overlay_container_left").hide();b==e.length-1&&a(".filo_overlay_container_right").hide();var g=parseInt(a(".filo_overlay_container").css("border-top-width").split("px")[0]),h=parseInt(a(".picture_counter").height()),f=(c.maxWidth?c.maxWidth:a.filo.maxWidth)/100,c=(c.maxHeight?c.maxHeight:a.filo.maxHeight)/100,j=a(window).width()*f-g,k=a(window).height()*c-(g+h),i=new Image;
i.onload=function(){var c=this.width,f=this.height,g,m;c>f?(g=c>j?j:c,m=g*f/c,m>k&&(m=f>k?k:f,g=m*c/f)):(m=f>k?k:f,g=m*c/f,g>j&&(g=c>j?j:c,m=g*f/c));0<a(".filo_overlay_container .filo_full_picture").length?a(".filo_overlay_container .filo_full_picture").fadeOut(300,function(){a(i).css("display","none");i.width=g;i.height=m;a(".filo_overlay_container").width(g).height(m).css("margin-left",-1*(g/2)).css("margin-top",-1*(m/2)-h).prepend(i).find(i).fadeIn(300);a(this).remove();a(".filo_overlay_container_close").show();
a(".filo_overlay_container .picture_counter").html("<span>Album: "+d+" | Pic: "+(parseInt(b)+1)+" of "+e.length+"</span>")}):(a(i).width(g).height(m),a(".filo_overlay_container").width(g).height(m).css("margin-left",-1*(g/2)).css("margin-top",-1*(m/2)-h).prepend(i).fadeIn(300),a(".filo_overlay_container_close").show(),a(".filo_overlay_container .picture_counter").html("<span>Album: "+d+" | Pic: "+(parseInt(b)+1)+" of "+e.length+"</span>"))};i.setAttribute("class","filo_full_picture");i.setAttribute("id",
b);i.src=e[b]}
function resizeImage(a,b){if(0<a(".filo_overlay").length&&!a.filo.resize){a(".filo_full_picture").css("width","").css("height","");resize=!0;var e=(b.maxWidth?b.maxWidth:a.filo.maxWidth)/100,d=(b.maxHeight?b.maxHeight:a.filo.maxHeight)/100;console.log(e);console.log(d);var c=parseInt(a(".filo_overlay_container").css("border-top-width").split("px")[0]),g=parseInt(a(".picture_counter").height()),e=a(window).width()*e-c,d=a(window).height()*d-(c+g),c=parseInt(a(".filo_full_picture").width()),h=parseInt(a(".filo_full_picture").height()),
f,j;c>h?(f=c>e?e:c,j=f*h/c,j>d&&(j=h>d?d:h,f=j*c/h)):(j=h>d?d:h,f=j*c/h,f>e&&(f=c>e?e:c,j=f*h/c));a(".filo_overlay_container img.filo_full_picture").width(f);a(".filo_overlay_container").width(f).height(j).css("margin-left",-1*(f/2)).css("margin-top",-1*(j/2)-g);resize=!1}}function inArray(a,b){for(var e=0;e<b.length;e++)if(a.toLowerCase()==b[e].toLowerCase())return!0;return!1}
function getRootPath(){try{throw Error();}catch(a){var b="";if(void 0!=a.fileName)b=a.fileName.split("/");else{var e=document.getElementsByTagName("script");filo_jQuery.each(e,function(a,d){0<=d.src.indexOf("filo.js")&&(b=d.src.split("/"))})}if(""==b)return"filo/"}for(var e="",d=0;d<b.length-1;d++)e=d<b.length-2?e+(b[d]+"/"):e+b[d];return e}function isInt(a){return"number"===typeof a&&0==a%1}"undefined"==typeof filo_jQuery.browser&&(filo_jQuery.browser={msie:"Microsoft Internet Explorer"==navigator.appName});
Date.now=Date.now||function(){return+new Date};
